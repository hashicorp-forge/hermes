# Multi-Provider Auth Architecture (Current State)

## System Overview

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         Hermes Frontend                             â”‚
â”‚                         (Ember.js App)                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                 â”‚
                    Runtime Config Detection
                                 â”‚
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚   ConfigService         â”‚
                    â”‚   auth_provider: string â”‚
                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                 â”‚
                â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                â”‚                â”‚                â”‚
         auth_provider     auth_provider    auth_provider
            = "google"        = "okta"         = "dex"
                â”‚                â”‚                â”‚
                â–¼                â–¼                â–¼
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚ Google OAuth    â”‚  â”‚ OIDC (Okta) â”‚  â”‚ OIDC (Dex)  â”‚
    â”‚ Flow            â”‚  â”‚ Flow        â”‚  â”‚ Flow        â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## Authentication Flows (Detailed)

### Google OAuth Flow (No Torii Needed)

```
â”Œâ”€â”€â”€â”€â”€â”€â”                â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”           â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ User â”‚                â”‚ Frontend â”‚              â”‚ Backend â”‚           â”‚ Google â”‚
â””â”€â”€â”¬â”€â”€â”€â”˜                â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜              â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜           â””â”€â”€â”€â”¬â”€â”€â”€â”€â”˜
   â”‚                         â”‚                         â”‚                    â”‚
   â”‚  Click "Sign in"        â”‚                         â”‚                    â”‚
   â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚                         â”‚                    â”‚
   â”‚                         â”‚                         â”‚                    â”‚
   â”‚                         â”‚ session.authenticate()  â”‚                    â”‚
   â”‚                         â”‚ (ember-simple-auth)     â”‚                    â”‚
   â”‚                         â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”               â”‚                    â”‚
   â”‚                         â”‚         â”‚               â”‚                    â”‚
   â”‚                         â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€â”˜               â”‚                    â”‚
   â”‚                         â”‚                         â”‚                    â”‚
   â”‚                         â”‚ Open OAuth popup        â”‚                    â”‚
   â”‚                         â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚
   â”‚                         â”‚                         â”‚                    â”‚
   â”‚  â—„â”€â”€â”€â”€ Auth Dialog â”€â”€â”€â”€â–ºâ”‚                         â”‚                    â”‚
   â”‚                         â”‚                         â”‚                    â”‚
   â”‚                         â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
   â”‚                         â”‚      Access Token       â”‚                    â”‚
   â”‚                         â”‚                         â”‚                    â”‚
   â”‚                         â”‚ Store in session        â”‚                    â”‚
   â”‚                         â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”               â”‚                    â”‚
   â”‚                         â”‚         â”‚               â”‚                    â”‚
   â”‚                         â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€â”˜               â”‚                    â”‚
   â”‚                         â”‚                         â”‚                    â”‚
   â”‚                         â”‚ API Call with header:   â”‚                    â”‚
   â”‚                         â”‚ Hermes-Google-Access-   â”‚                    â”‚
   â”‚                         â”‚ Token: <token>          â”‚                    â”‚
   â”‚                         â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚                    â”‚
   â”‚                         â”‚                         â”‚                    â”‚
   â”‚                         â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤                    â”‚
   â”‚                         â”‚    Protected Resource   â”‚                    â”‚
   â”‚                         â”‚                         â”‚                    â”‚
```

**Key Points**:
- âœ… Frontend manages OAuth flow directly
- âœ… Uses ember-simple-auth (NOT Torii library)
- âœ… Custom header: `Hermes-Google-Access-Token`
- âœ… Token stored in browser session

### OIDC Flow (Okta/Dex) - Backend-Centric

```
â”Œâ”€â”€â”€â”€â”€â”€â”              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”           â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ User â”‚              â”‚ Frontend â”‚                â”‚ Backend â”‚           â”‚ OIDC     â”‚
â”‚      â”‚              â”‚          â”‚                â”‚         â”‚           â”‚ Provider â”‚
â””â”€â”€â”¬â”€â”€â”€â”˜              â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜                â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜           â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜
   â”‚                       â”‚                           â”‚                     â”‚
   â”‚  Click "Sign in"      â”‚                           â”‚                     â”‚
   â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚                           â”‚                     â”‚
   â”‚                       â”‚                           â”‚                     â”‚
   â”‚                       â”‚ Redirect to:              â”‚                     â”‚
   â”‚                       â”‚ /api/v2/auth/{provider}/  â”‚                     â”‚
   â”‚                       â”‚ login                     â”‚                     â”‚
   â”‚                       â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚                     â”‚
   â”‚                       â”‚                           â”‚                     â”‚
   â”‚                       â”‚                           â”‚ Generate state,     â”‚
   â”‚                       â”‚                           â”‚ Redirect to OIDC    â”‚
   â”‚                       â”‚                           â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚
   â”‚                       â”‚                           â”‚                     â”‚
   â”‚  â—„â”€â”€â”€â”€â”€â”€â”€â”€ Browser redirected to OIDC Provider â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–º  â”‚
   â”‚                       â”‚                           â”‚                     â”‚
   â”‚  â—„â”€â”€â”€â”€ Auth Dialog â”€â”€â–ºâ”‚                           â”‚                     â”‚
   â”‚                       â”‚                           â”‚                     â”‚
   â”‚                       â”‚                           â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
   â”‚                       â”‚                           â”‚  Auth Code          â”‚
   â”‚                       â”‚                           â”‚                     â”‚
   â”‚                       â”‚                           â”‚ Exchange for tokens â”‚
   â”‚                       â”‚                           â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚
   â”‚                       â”‚                           â”‚                     â”‚
   â”‚                       â”‚                           â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
   â”‚                       â”‚                           â”‚  ID Token, Access   â”‚
   â”‚                       â”‚                           â”‚  Token              â”‚
   â”‚                       â”‚                           â”‚                     â”‚
   â”‚                       â”‚                           â”‚ Create session      â”‚
   â”‚                       â”‚                           â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”           â”‚
   â”‚                       â”‚                           â”‚         â”‚           â”‚
   â”‚                       â”‚                           â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€â”˜           â”‚
   â”‚                       â”‚                           â”‚                     â”‚
   â”‚                       â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤                     â”‚
   â”‚                       â”‚  Redirect to app          â”‚                     â”‚
   â”‚                       â”‚  (with session cookie)    â”‚                     â”‚
   â”‚                       â”‚                           â”‚                     â”‚
   â”‚                       â”‚  API Call with header:    â”‚                     â”‚
   â”‚                       â”‚  Authorization: Bearer    â”‚                     â”‚
   â”‚                       â”‚  <jwt>                    â”‚                     â”‚
   â”‚                       â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚                     â”‚
   â”‚                       â”‚                           â”‚                     â”‚
   â”‚                       â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤                     â”‚
   â”‚                       â”‚   Protected Resource      â”‚                     â”‚
   â”‚                       â”‚                           â”‚                     â”‚
```

**Key Points**:
- âœ… Backend handles OIDC protocol completely
- âœ… Frontend only does redirect (no OAuth library needed)
- âœ… Standard header: `Authorization: Bearer <jwt>`
- âœ… Session cookie maintained by backend

## Provider Detection Pattern

```typescript
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    Application Startup                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                 â”‚
                 â–¼
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚ GET /api/v2/web/config â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                 â”‚
                 â–¼
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚ {                        â”‚
    â”‚   auth_provider: "dex",  â”‚   â—„â”€â”€ Backend determines provider
    â”‚   api_version: "v2",     â”‚
    â”‚   feature_flags: {...}   â”‚
    â”‚ }                        â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                 â”‚
                 â–¼
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚  ConfigService.config.auth_provider    â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
               â”‚
               â”‚ Used by:
               â”œâ”€â”€â–º SessionService (auth flow selection)
               â”œâ”€â”€â–º FetchService (header selection)
               â”œâ”€â”€â–º SearchService (header selection)
               â””â”€â”€â–º AuthenticateController (UI/button selection)
```

## Header Selection Logic

```typescript
// Pattern used across services (fetch, search, etc.)

function getAuthHeaders(authProvider: string, token: string) {
  if (authProvider === "google") {
    return {
      "Hermes-Google-Access-Token": token
    };
  } else if (authProvider === "dex" || authProvider === "okta") {
    return {
      "Authorization": `Bearer ${token}`
    };
  }
  return {};
}

// Applied automatically to all backend API calls
```

## Component Architecture

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     Authenticate Route                      â”‚
â”‚                                                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚           AuthenticateController                   â”‚    â”‚
â”‚  â”‚                                                     â”‚    â”‚
â”‚  â”‚  authProvider = config.auth_provider               â”‚    â”‚
â”‚  â”‚                                                     â”‚    â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚    â”‚
â”‚  â”‚  â”‚ authenticate()    â”‚   â”‚ authenticateOIDC()   â”‚ â”‚    â”‚
â”‚  â”‚  â”‚ (Google OAuth)    â”‚   â”‚ (Okta/Dex OIDC)      â”‚ â”‚    â”‚
â”‚  â”‚  â”‚                   â”‚   â”‚                      â”‚ â”‚    â”‚
â”‚  â”‚  â”‚ Uses:             â”‚   â”‚ Uses:                â”‚ â”‚    â”‚
â”‚  â”‚  â”‚ ember-simple-auth â”‚   â”‚ window.location.href â”‚ â”‚    â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                           â”‚
                           â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      SessionService                         â”‚
â”‚                                                              â”‚
â”‚  isUsingOIDC = (provider === "okta" || provider === "dex")  â”‚
â”‚                                                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚  pollForExpiredAuth()                              â”‚    â”‚
â”‚  â”‚  â€¢ Checks session validity                         â”‚    â”‚
â”‚  â”‚  â€¢ Shows re-auth prompts                           â”‚    â”‚
â”‚  â”‚  â€¢ Different logic for OIDC vs Google              â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                           â”‚
                           â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                       FetchService                          â”‚
â”‚                                                              â”‚
â”‚  fetch(url, options) {                                      â”‚
â”‚    if (authProvider === "google") {                         â”‚
â”‚      headers["Hermes-Google-Access-Token"] = token;         â”‚
â”‚    } else if (authProvider === "dex" || authProvider ===    â”‚
â”‚                "okta") {                                     â”‚
â”‚      headers["Authorization"] = `Bearer ${token}`;          â”‚
â”‚    }                                                         â”‚
â”‚  }                                                           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## Why No Torii Needed

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              What Torii Was Designed For                â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                          â”‚
â”‚  â€¢ Popup-based OAuth flows (Google, Facebook, GitHub)  â”‚
â”‚  â€¢ Multiple OAuth providers with similar flows          â”‚
â”‚  â€¢ Client-side token management                         â”‚
â”‚  â€¢ Provider abstraction layer                           â”‚
â”‚                                                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                           â”‚
                           â–¼
         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
         â”‚   Does Hermes Need This?       â”‚
         â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                  â”‚
      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
      â”‚                       â”‚
      â–¼                       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Google OAuth â”‚      â”‚  OIDC (Okta/Dex) â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜      â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚                       â”‚
       â”‚ Popup flow            â”‚ Server redirect
       â”‚ âœ… Works with         â”‚ âŒ Doesn't use
       â”‚    ember-simple-auth  â”‚    popups at all!
       â”‚    directly           â”‚
       â”‚                       â”‚ Backend handles
       â”‚ âŒ Torii adds no      â”‚ entire flow
       â”‚    value              â”‚
       â”‚                       â”‚ âŒ Torii NOT
       â”‚                       â”‚    applicable
       â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## Comparison: With vs Without Torii

### âŒ With Torii (Unnecessarily Complex)

```typescript
// Would need:
- Torii library (dependency)
- Torii initializer (configuration)
- Torii providers for each OAuth method
- Torii authenticator wrapper
- Maintenance overhead

// But provides:
- Abstraction we don't need (only 1 OAuth provider)
- Complexity for OIDC that doesn't use it
```

### âœ… Without Torii (Current - Simpler)

```typescript
// What we have:
- ember-simple-auth (already required)
- Simple if/else provider detection
- Backend handles OIDC
- Clear, maintainable code

// Benefits:
- One less dependency
- Simpler mental model
- Backend-centric OIDC (correct pattern)
- Easy to test
```

## Decision Matrix

| Criteria | With Torii | Without Torii (Current) |
|----------|-----------|------------------------|
| **Dependencies** | +1 (Torii) | 0 |
| **Complexity** | High | Low |
| **OIDC Support** | Not designed for it | âœ… Native pattern |
| **Google OAuth** | Works | âœ… Works (ember-simple-auth) |
| **Maintenance** | More code | Less code |
| **Ember 6.x Compat** | âŒ Broken | âœ… Working |
| **Testing** | Mock Torii + providers | Mock auth provider config |
| **Provider Addition** | Add Torii provider | Add if/else case |

## Recommendation Summary

### âœ… Current Pattern is Optimal

**Keep using**: Runtime provider detection with direct authentication flows

**Reasons**:
1. Simpler architecture
2. Fewer dependencies
3. Backend-centric OIDC (industry standard)
4. Already working and tested
5. Torii provides no benefit for current use case

### ğŸ§¹ Cleanup Tasks

1. Remove Torii initializer stub
2. Remove Torii provider stubs
3. Rename authenticator (torii â†’ oauth or custom-auth)
4. Update documentation
5. Add tests for each provider flow

---

**Created**: October 6, 2025  
**Related Docs**:
- `TORII_AUTH_ANALYSIS.md` - Full analysis
- `AUTH_PROVIDER_SELECTION.md` - Provider selection logic
- `DEX_AUTHENTICATION.md` - Dex OIDC setup
