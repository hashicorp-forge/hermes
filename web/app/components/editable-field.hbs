<div
  class="editable-field
    {{if (and this.editingIsEnabled (not @isSaving)) 'z-10'}}"
  ...attributes
>
  {{#if (and this.editingIsEnabled (not @isSaving))}}

    {{on-document "keydown" this.handleKeydown}}

    <div {{did-insert this.registerEditingContainer}} class="w-full">
      {{#if (eq @type "people")}}

        <Inputs::PeopleSelect
          {{autofocus targetChildren=true}}
          data-test-document-contributors-editable
          class="multiselect--narrow"
          @selected={{this.value}}
          @onChange={{this.onChange}}
          @onKeydown={{fn this.onPeopleSelectKeydown this.maybeUpdateValue}}
          {{! we dont need to pass in this.value probably }}
          {{click-outside (fn this.maybeUpdateValue this.value)}}
        />

      {{else}}
        <Hds::Form::Textarea::Field
          {{auto-height-textarea}}
          {{did-insert this.registerInput}}
          {{dismissible
            dismiss=(fn this.maybeUpdateValue this.value)
            related=this.relatedButtons
            shouldIgnoreEscape=true
          }}
          @value={{this.value}}
          placeholder={{@placeholder}}
          name={{@name}}
          as |F|
        >
          {{#if this.emptyValueErrorIsShown}}
            <F.Error data-test-empty-value-error>This field is required</F.Error>
          {{/if}}
        </Hds::Form::Textarea::Field>
      {{/if}}
      <div
        class="edit-overlay-affordance
          {{if (eq @buttonOverlayColor 'white') 'white' 'page-faint'}}
          {{if (eq @buttonPlacement 'center') 'justify-center' 'pl-[5px]'}}"
        style="padding-bottom: {{if
          @buttonOverlayPaddingBottom
          @buttonOverlayPaddingBottom
          '125px'
        }}"
      >
        <Hds::Button
          @size="small"
          @text="Save"
          @icon="check"
          @isIconOnly={{true}}
          {{on "click" (fn this.maybeUpdateValue this.value)}}
        />
        <Hds::Button
          @text="Cancel"
          @icon="x"
          @isIconOnly={{true}}
          @size="small"
          @color="secondary"
          {{did-insert this.registerCancelButton}}
          {{on "click" this.revertChanges}}
        />

      </div>
    </div>

  {{else}}
    {{#if (or @isSaving @isLoading)}}
      <div
        data-test-spinner
        class={{if
          @isSaving
          "absolute top-2.5 right-[9px]"
          "flex h-5 items-center"
        }}
      >
        <FlightIcon @name="loading" data-test-loading-spinner />
      </div>
    {{/if}}
    <Action
      {{did-insert this.registerToggleButton}}
      class="field-toggle group {{if @isSaving 'saving'}}"
      disabled={{or @disabled @isSaving}}
      {{on "click" this.enableEditing}}
    >
      {{#let (element (or @tag "p")) as |Field|}}
        <Field class="w-full">
          {{#if this.value.length}}
            {{#if (eq @type "people")}}
              <ol class="person-list">
                {{#each this.value as |person|}}
                  <li>
                    <Person @imgURL={{person.imgURL}} @email={{person.email}} />
                  </li>
                {{/each}}
              </ol>
            {{else}}
              {{this.value}}

            {{/if}}

          {{else}}
            <EmptyStateText />

          {{/if}}

        </Field>
      {{/let}}
      {{#unless @disabled}}
        <span class="edit-affordance gray">
          <FlightIcon @name="edit" class="text-color-foreground-faint" />
        </span>
      {{/unless}}
    </Action>
  {{/if}}
</div>
