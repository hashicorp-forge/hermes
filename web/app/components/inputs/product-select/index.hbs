{{! https://www.w3.org/WAI/ARIA/apg/patterns/combobox/examples/combobox-select-only/ }}
<div
  data-test-product-select
  ...attributes
  {{did-insert this.maybeFetchProducts}}
>
  {{#if this.errorIsShown}}
    <div class="failed-to-load-text">
      Failed to load
    </div>
    <Hds::Button
      data-test-product-select-failed-to-load-button
      @color="secondary"
      @size="small"
      {{on "click" (perform this.fetchProductAreas)}}
      @text="Retry"
      @icon="reload"
    />
  {{else}}
    {{#if @formatIsBadge}}
      <Inputs::BadgeDropdownList
        @items={{this.products}}
        @listIsOrdered={{true}}
        @onItemClick={{this.onChange}}
        @selected={{@selected}}
        @placement={{if @placement @placement "bottom-start"}}
        @isSaving={{@isSaving}}
        @isLoading={{this.fetchProductAreas.isRunning}}
        @renderOut={{@renderOut}}
        @icon={{this.icon}}
        class="product-select-dropdown-list w-80"
        ...attributes
      >
        <:item as |dd|>
          <dd.Action data-test-product-select-badge-dropdown-item>
            <Inputs::ProductSelect::Item
              @product={{dd.value}}
              @isSelected={{dd.isSelected}}
            />
          </dd.Action>
        </:item>
      </Inputs::BadgeDropdownList>
    {{else}}
      <X::DropdownList
        @items={{this.products}}
        @listIsOrdered={{true}}
        @onItemClick={{this.onChange}}
        @selected={{@selected}}
        @placement={{@placement}}
        @isLoading={{this.fetchProductAreas.isRunning}}
        @renderOut={{@renderOut}}
        @matchAnchorWidth={{hash enabled=true additionalWidth=10}}
        class="product-select-dropdown-list"
        ...attributes
      >
        <:anchor as |dd|>
          <dd.ToggleSelect>
            <FlightIcon
              @name={{or (get-product-id dd.selected) "folder"}}
              class="mr-3"
            />
            <span data-test-selected-value class="text-color-foreground-strong">
              {{or @selected "---"}}
            </span>

            {{#if this.selectedProductAbbreviation}}
              <span class="product-select-toggle-abbreviation">
                {{this.selectedProductAbbreviation}}
              </span>
            {{/if}}
          </dd.ToggleSelect>
        </:anchor>
        <:item as |dd|>
          <dd.Action class="pr-5">
            <Inputs::ProductSelect::Item
              @product={{dd.value}}
              @isSelected={{dd.isSelected}}
              @abbreviation={{dd.attrs.abbreviation}}
              class="px-[5px]"
            />
          </dd.Action>
        </:item>
      </X::DropdownList>
    {{/if}}
  {{/if}}
</div>
