<div class="w-full">

  <div class="relative z-10 flex items-center w-full justify-between">
    <div class="hds-typography-body-100 hds-foreground-faint">
      Related docs
    </div>
    {{! @glint-ignore}}
    <Action
      class="flex items-center ml-px -mr-px px-1 py-1 rounded border hover:border-color-border-strong"
      {{on "click" this.showContent}}
    >
      <FlightIcon @name="plus" />
    </Action>
  </div>
</div>

{{#if this.contentIsShown}}
  {{#in-element (html-element ".ember-application") insertBefore=null}}
    <div
      class="absolute top-32 w-[600px] h-96 left-1/2 -translate-x-1/2 bg-red-400 z-50"
    >
      {{! @glint-ignore}}
      <X::DropdownList
        @items={{this.shownDocuments}}
        @onItemClick={{this.addRelatedDocument}}
        @inputVisibility="hidden"
        @renderOut={{true}}
        @offset={{hash mainAxis=3 crossAxis=-6}}
        @isLoading={{this.maybeLoadSuggestions.isRunning}}
        class="w-full"
      >
        <:anchor as |dd|>
          {{log dd}}
          <dd.ToggleAction {{did-insert this.didInsertContent}} />
        </:anchor>
        <:header>
          <div class="x-dropdown-list-input-container">

            {{! @glint-ignore - not yet registered}}
            <Hds::Form::TextInput::Base
              value={{this.query}}
              {{on "input" this.onInput}}
              {{on "keydown" this.onKeydown}}
              {{did-insert this.registerAndFocusSearchInput}}
              type="text"
              placeholder="Paste a URL or search documents..."
            />
          </div>
        </:header>
        <:item as |dd|>
          <dd.Action
            class="w-full flex items-start py-1.5 px-3 space-x-3 hover:bg-color-surface-interactive-hover"
          >
            <div
              class="shrink-0 flex p-px hds-surface-mid rounded-sm mt-0.5 overflow-hidden bg-white"
            >
              <img src="/images/document.png" class="w-5 h-auto" />
            </div>
            <div>
              <h4 class="inline-doc-title mb-0.5 pr-0.5">
                {{dd.attrs.title}}
              </h4>
              {{#if dd.attrs.docNumber}}
                <span class="text-color-foreground-faint text-body-100">
                  {{dd.attrs.docNumber}}
                </span>
              {{/if}}
            </div>
          </dd.Action>
        </:item>
      </X::DropdownList>
    </div>
  {{/in-element}}
{{/if}}

{{! TODO: move this out of the component }}

{{#if this.relatedResources.length}}
  <ul class="mt-1 related-docs">
    {{#each-in this.relatedResources as |i doc|}}
      {{log i}}
      {{log doc}}
      <li
        class="flex w-full relative group related-docs-list-item
          {{if doc.objectID 'hermes-doc' 'external-doc'}}"
      >
        {{#if doc.objectID}}
          <LinkTo
            @route="authenticated.document"
            @model={{doc.objectID}}
            class="related-doc-link"
          >
            <div
              class="shrink-0 p-px hds-surface-mid rounded-sm flex mt-1 overflow-hidden bg-white"
            >
              <img src="/images/document.png" class="w-5 h-auto" />
            </div>
            <div>
              <div>
                {{! Create space for the "more" icon }}
                <div class="float-right mt-0.5 w-7 h-3"></div>

                <h4 class="inline-doc-title mb-0.5 pr-0.5">
                  {{doc.title}}
                </h4>
              </div>
              {{#if doc.docNumber}}
                <span class="text-color-foreground-faint text-body-100">
                  {{doc.docNumber}}
                </span>
              {{/if}}
            </div>
          </LinkTo>
        {{else}}
          <ExternalLink
            href={{doc.url}}
            class="py-0.5 flex underline mr-6 truncate"
          >
            <div class="flex items-center w-full">
              <div class="flex relative mr-2 w-4 h-4 shrink-0">
                <img
                  src="https://www.google.com/s2/favicons?domain={{doc.url}}"
                  width="16"
                  height="16"
                />
              </div>
              <span class="truncate">
                {{doc.displayURL}}
              </span>
            </div>
          </ExternalLink>
        {{/if}}
        <Inputs::DocumentSelect::MoreButton
          @removeResource={{this.removeResource}}
          @resource={{doc}}
        />
      </li>
    {{/each-in}}
  </ul>
{{else}}
  <div class="mt-1.5 text-color-foreground-faint">
    ---
  </div>
{{/if}}
