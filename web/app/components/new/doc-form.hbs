{{#if this.docIsBeingCreated}}
  <div class="hds-typography-display-400 mt-3 text-center">
    <FlightIcon @name="loading" @size="24" />
    <div class="mt-8 text-display-200 font-semibold">
      Creating
      {{@docType}}
      draft...
    </div>
    <div class="text-body-200 text-color-foreground-faint">This usually takes
      10-20 seconds.</div>
  </div>
{{else}}
  <form
    class="mx-auto max-w-lg"
    {{on "submit" this.submit}}
    {{did-insert this.registerForm}}
  >
    <div>
      <div class="space-y-4">
        <h1
          class="hds-typography-display-500 hds-font-weight-bold hds-foreground-strong flex"
        >
          New
          <X::DropdownList
            @items={{this.objectTypes}}
            @selected={{this.selectedObjectType}}
            {{!-- @offset={{hash crossAxis=-1 mainAxis=5}} --}}
          >
            <:anchor as |dd|>
              <dd.ToggleAction
                class="hover:hds-elevation-low group relative ml-[1px] -mt-0.5 -mb-[3px] flex items-center rounded-button-md border border-transparent px-2 pt-0.5 pb-[3px] hover:border-color-border-strong
                  {{if dd.contentIsShown 'has-focus-ring'}}"
              >
                {{dd.selected}}
                <FlightIcon
                  @name="caret"
                  class="ml-1
                    {{unless dd.contentIsShown 'text-color-foreground-faint'}}
                    group-hover:text-color-foreground-strong"
                />
              </dd.ToggleAction>

            </:anchor>
            <:item as |dd|>
              <dd.Action
                class="flex items-center justify-between pl-3.5 pr-5 text-display-300 font-regular text-color-foreground-primary"
                {{on "click" (fn this.changeObjectType dd.value)}}
              >

                <span>
                  {{dd.value}}
                </span>
                <FlightIcon
                  @name="check"
                  class="ml-8 text-color-foreground-action
                    {{unless dd.isSelected 'invisible'}}"
                />
              </dd.Action>
            </:item>
          </X::DropdownList>
        </h1>
      </div>
      <div class="space-y-7 pt-8">

        {{! Title }}
        <Hds::Form::TextInput::Field
          @isRequired={{true}}
          @value={{this.title}}
          @type="text"
          name="title"
          {{on "input" this.updateForm}}
          as |F|
        >
          <F.Label class="relative">
            Title
          </F.Label>
          {{! <F.HelperText>
            A succinct outline of the idea you ºre proposing.
          </F.HelperText> }}
        </Hds::Form::TextInput::Field>

        {{! Summary }}
        <div class="relative">
          <Hds::Form::Textarea::Field
            @value={{this.summary}}
            rows="3"
            name="summary"
            {{on "input" this.updateForm}}
            as |F|
          >
            <F.Label>Summary</F.Label>
            <F.HelperText>
              <span
                class={{if
                  this.summaryIsLong
                  "bg-color-surface-warning text-color-foreground-warning-on-surface transition-colors"
                }}
              >One or two sentences</span>
              outlining your
              {{if this.objectTypeIsProject "project" "doc"}}.
              {{if this.summaryIsLong "(Just a recommendation)"}}
            </F.HelperText>
          </Hds::Form::Textarea::Field>
        </div>

        {{#unless this.objectTypeIsProject}}
          {{! Document type }}
          <div>
            <X::DropdownList
              class="product-select-dropdown-list"
              @items={{this.docTypes}}
              @selected={{this.selectedDocType}}
              @matchAnchorWidth={{true}}
            >
              <:anchor as |dd|>
                <div class="mb-2 flex items-center justify-between">
                  <div class="flex items-center">
                    <label class="hermes-form-label relative">
                      Document type
                    </label>
                    <Hds::Badge @text="Required" @size="small" class="ml-1.5" />
                    <Action
                      {{on "click" this.showDocTypeModal}}
                      class="ml-1.5 flex text-color-foreground-faint opacity-75 hover:opacity-100"
                    >
                      <FlightIcon @name="info-fill" class="" />
                    </Action>
                  </div>
                </div>
                <dd.ToggleAction
                  class="x-dropdown-list-toggle-select product-select-default-toggle hds-button hds-button--color-secondary hds-button--size-medium w-full"
                >
                  {{#if dd.selected}}
                    <FlightIcon
                      @name={{or dd.selected.icon "file-text"}}
                      class="mr-2.5"
                    />
                  {{/if}}
                  <div
                    class={{unless
                      dd.selected.longName
                      "text-color-foreground-faint"
                    }}
                  >
                    {{or dd.selected.longName "---"}}
                  </div>
                  {{#if dd.selected.shortName}}
                    <div class="ml-2 text-body-100 leading-none opacity-50">
                      {{dd.selected.shortName}}
                    </div>
                  {{/if}}
                  <FlightIcon
                    @name="caret"
                    class="product-select-toggle-caret"
                  />
                </dd.ToggleAction>
              </:anchor>
              <:item as |dd|>
                <dd.Action
                  class="pr-5"
                  {{on "click" (fn this.changeDocType dd.attrs.shortName)}}
                >
                  <div class="flex items-center">
                    <FlightIcon
                      @name={{or dd.attrs.icon "file-text"}}
                      class="mr-2.5"
                    />
                    {{dd.attrs.longName}}
                    <div class="ml-2 text-body-100 opacity-50">
                      {{dd.attrs.shortName}}
                    </div>
                  </div>
                </dd.Action>
              </:item>
            </X::DropdownList>
          </div>

          {{! Product/Area }}
          <div>
            <div class="mb-2">
              <span class="hermes-form-label relative">
                Product/Area
                <Hds::Badge @text="Required" @size="small" class="ml-1.5" />
              </span>
            </div>
            <Inputs::ProductSelect
              @selected={{this.productArea}}
              @onChange={{this.onProductSelect}}
              @isFullWidth={{true}}
            />
          </div>

          {{! Contributors }}
          <Hds::Form::Field @layout="vertical" as |F|>
            <F.Control>
              <Inputs::PeopleSelect
                class="multiselect mt-2 w-full"
                @selected={{this.contributors}}
                @onChange={{this.updateContributors}}
              />
            </F.Control>
            <F.Label>
              Contributors
            </F.Label>
            {{#if this.formErrors.contributors}}
              <F.Error as |E|>
                <E.Message>{{this.formErrors.contributors}}</E.Message>
              </F.Error>
            {{/if}}
            <F.HelperText>
              People to share your doc with. You can always add more later.
            </F.HelperText>
          </Hds::Form::Field>
        {{/unless}}
      </div>

      <Hds::Button
        @text="Create new {{if this.objectTypeIsProject 'project' 'document'}}"
        type="submit"
        class="mt-8 mb-10"
      />
    </div>
    {{!-- <div>
      <div class="preview-card">
        <h3>
          <FlightIcon @name="eye" />
          Preview
        </h3>
        <Doc::Tile
          @productArea={{this.productArea}}
          @status="draft"
          @title={{this.title}}
          @owner={{this.authenticatedUser.info.email}}
        />
        <Hds::Button
          @text="Create {{@docType}} in Google Drive"
          type="submit"
          disabled={{not this.formRequirementsMet}}
          class="w-full"
        />
      </div>
    </div> --}}
  </form>
{{/if}}

{{#if this.docTypeModalIsShown}}
  <Hds::Modal @onClose={{this.hideDocTypeModal}} class="scrollable" as |M|>
    <M.Header>Document types</M.Header>
    <M.Body>
      <div class="scrollable-container max-h-[380px]">

        <ul class="mt-5 space-y-5">
          {{#each this.docTypes as |docType|}}
            <li>
              <div class="flex items-center">
                <h5 class="mb-0.5 flex text-display-200 font-semibold">
                  {{docType.longName}}
                  <span
                    class="ml-1.5 flex font-regular text-color-foreground-primary"
                  >
                    ({{docType.shortName}})
                  </span>
                </h5>
              </div>
              <p class="text-body-200">
                {{or docType.description "No description provided."}}
              </p>
              {{#if docType.moreInfoLink}}
                <ExternalLink
                  href={{docType.moreInfoLink.url}}
                  @iconIsShown={{true}}
                  class="mt-1 text-body-200 text-color-foreground-action"
                >
                  {{docType.moreInfoLink.text}}
                </ExternalLink>
              {{/if}}
            </li>
          {{/each}}
        </ul>
        <div
          class="sticky bottom-0 left-0 h-12 w-full bg-gradient-to-t from-white to-white/0"
        ></div>
      </div>
    </M.Body>

  </Hds::Modal>
{{/if}}
