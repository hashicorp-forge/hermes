<New::Form
  data-test-project-form
  @taskIsRunning={{this.projectIsBeingCreated}}
  @icon="grid"
  @headline="Start a project"
  @taskIsRunningHeadline="Creating project..."
  @taskIsRunningDescription="This shouldn't take long."
  @buttonText="Create project"
  @isModal={{@isModal}}
  @buttonIsActive={{gt this.title.length 0}}
  @isModal={{@isModal}}
  {{on "submit" this.maybeSubmitForm}}
>
  <Hds::Form::Textarea::Field
    {{on "keydown" this.onKeydown}}
    {{auto-height-textarea}}
    autofocus
    {{autofocus}}
    data-test-title
    @value={{this.title}}
    name="title"
    placeholder="Enter a project title"
    as |F|
  >
    <F.Label @isRequired={{true}}>
      Title
    </F.Label>
    {{#if this.titleErrorIsShown}}
      <F.Error data-test-title-error class="mt-2">
        Title is required.
      </F.Error>
    {{/if}}
  </Hds::Form::Textarea::Field>

  {{#if this.projectIsBeingCreated}}
    <FlightIcon data-test-feature-icon @name="running" @size="24" />
    <div
      data-test-task-is-running-description
      class="mt-2 -mb-3 text-center text-body-300 text-color-foreground-faint"
    >
      Creating project...
    </div>
  {{else if this.jiraSearchIsShowing}}
    <X::DropdownList
      @inputIsShown={{false}}
      @items={{this.shownJiraIssues}}
      @disableClose={{true}}
      @onItemClick={{this.addJiraIssue}}
      @placement={{null}}
      @isLoading={{this.loadInitialJiraIssues.isRunning}}
      class="non-floating-list theme-neutral"
    >
      <:anchor as |dd|>
        <div class="relative mb-4" {{did-insert dd.registerAnchor}}>
          <Hds::Form::TextInput::Base
            {{autofocus}}
            @type="search"
            @value={{this.jiraSearchQuery}}
            {{did-insert (perform this.loadInitialJiraIssues)}}
            {{on "input" this.updateJiraSearchQuery}}
            placeholder="Search Jira issues"
            aria-label="Search Jira issues"
            aria-haspopup="listbox"
            aria-controls={{dd.ariaControls}}
            aria-expanded={{dd.contentIsShown}}
          />
          {{#if this.searchJiraIssues.isRunning}}
            <div
              class="absolute top-1/2 right-3 flex -translate-y-1/2 bg-white"
            >
              <FlightIcon @name="loading" />
            </div>
          {{/if}}
        </div>
      </:anchor>
      <:item as |dd|>
        <dd.Action>
          {{!  }}
          Actttion
        </dd.Action>
      </:item>
      <:no-matches>
        No matches TODO
        <Action {{on "click" (fn this.addJiraIssue "not null")}}>
          Fake selecting a Jira issue
        </Action>
      </:no-matches>
      <:loading>
        <div class="h-48">
          <FlightIcon @name="loading" class="mt-4" />
        </div>
      </:loading>
    </X::DropdownList>
  {{else}}
    <div class="grid gap-5 px-8 pt-2 pb-8">
      <New::ProjectForm />
      <Hds::Button
        data-test-submit
        @text="Create project"
        @isFullWidth={{true}}
        @color="primary"
        type="submit"
        class="mt-4"
      />
    </div>
  {{/if}}

</New::Form>
