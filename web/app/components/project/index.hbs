<header class="mb-7 border-b border-b-color-border-faint bg-color-page-faint">
  <Header::Nav />
</header>
<div class="x-container -mt-2">
  <div class="flex items-center justify-between">
    {{! TODO: componentize this button style }}
    <LinkTo
      @route="authenticated.projects"
      class="flex items-center rounded-button-md border border-transparent py-2 px-3 hover:border-color-border-strong"
    >
      <FlightIcon @name="arrow-left" class="mr-2" />
      All projects
    </LinkTo>
    <div class="flex space-x-0.5">
      <CopyURLButton
        @url="TODO"
        class="flex items-center rounded-button-md border border-transparent py-2 px-3 text-color-foreground-primary hover:border-color-border-strong"
      />
      {{! TODO: figure out what links need to be here }}
      <X::DropdownList
        @items={{hash
          edit=(hash
            name="Edit title/description..." icon="edit" action=this.showModal
          )
          archive=(hash name="Archive..." icon="archive" action=this.showModal)
          delete=(hash name="Delete..." icon="trash" action=this.showModal)
        }}
        @placement="bottom-end"
      >
        <:anchor as |dd|>
          <dd.ToggleAction>
            <div
              class="flex items-center rounded-button-md border border-transparent py-2 px-3 text-color-foreground-primary hover:border-color-border-strong
                {{if dd.contentIsShown 'border-color-border-strong'}}"
            >
              <FlightIcon @name="settings" />
              <FlightIcon
                @name={{if dd.contentIsShown "chevron-up" "chevron-down"}}
                class="ml-0.5"
              />
            </div>
          </dd.ToggleAction>
        </:anchor>
        <:item as |dd|>
          <dd.Action {{on "click" dd.attrs.action}} class="h-9 pl-4 pr-6">
            <FlightIcon @name={{dd.attrs.icon}} class="mr-2.5" />
            {{dd.attrs.name}}
          </dd.Action>
        </:item>
      </X::DropdownList>
      {{! TODO: add settings dropdown }}
    </div>
  </div>

  <div class="mb-14">
    <div class="mx-auto max-w-lg">
      <Action {{on "click" this.showModal}} class="w-full text-center">
        <h1 class="mb-0 text-display-400">
          {{@project.name}}
        </h1>
        {{#if @project.description}}
          <p class="mt-2">
            {{@project.description}}
          </p>
        {{/if}}
      </Action>
      {{#if this.modalIsShown}}
        <Hds::Modal @onClose={{this.hideModal}} as |M|>
          <M.Header>
            Project info
          </M.Header>
          <M.Body>
            <Hds::Form::TextInput::Field
              @value={{@project.name}}
              class="mb-6"
              as |T|
            >
              <T.Label>Name</T.Label>
            </Hds::Form::TextInput::Field>
            <Hds::Form::TextInput::Field
              @value={{@project.description}}
              @isOptional={{true}}
              class="mb-5"
              as |T|
            >
              <T.Label>Description</T.Label>
            </Hds::Form::TextInput::Field>
          </M.Body>
          <M.Footer as |F|>
            <Hds::ButtonSet>
              <Hds::Button
                {{on "click" this.saveProjectInfo}}
                @text="Save changes"
              />
              <Hds::Button
                {{on "click" F.close}}
                @text="Cancel"
                @color="secondary"
              />
            </Hds::ButtonSet>
          </M.Footer>
        </Hds::Modal>
      {{/if}}
    </div>

    <div class="mt-3 flex justify-center">
      {{#if @project.jiraObject}}
        <div
          class="flex h-9 items-center rounded border border-color-border-primary px-3"
        >

          <div class="flex h-9 items-center space-x-1.5">
            <FlightIcon @name="jira" class="mr-3" />
            {{#if @project.jiraObject.type}}
              <div class="flex">
                <FlightIcon @name="square-fill" class="text-lime-600" />
              </div>
            {{/if}}
            <div
              class="text-color-foreground-faint
                {{if (eq @project.jiraObject.status 'done') 'line-through'}}"
            >
              {{@project.jiraObject.key}}
            </div>
            <div class="max-w-[180px]">
              <TruncatedText
                class="text-body-200 text-color-foreground-primary"
              >
                {{@project.jiraObject.summary}}
              </TruncatedText>
            </div>
            {{#if @project.jiraObject.priority}}
              <div class="flex">
                <FlightIcon
                  @name="chevrons-up"
                  class="text-color-foreground-critical"
                />
              </div>
            {{/if}}
            {{#if @project.jiraObject.assignee}}
              <Person::Avatar @email={{@project.jiraObject.assignee}} />
            {{/if}}
          </div>
          <div class="ml-3 flex shrink-0">
            <FlightIcon @name="more-vertical" />
          </div>
        </div>
      {{else}}
        <Hds::Button
          @color="secondary"
          @icon="jira"
          @text="Attach Jira issue"
        />
      {{/if}}
    </div>
  </div>

  <div
    class="mx-auto mb-8 max-w-2xl rounded border border-color-border-primary"
  >
    <RelatedResources
      @allowAddingExternalLinks={{false}}
      @items={{@project.documents}}
      @addResource={{this.addResource}}
      @modalHeaderTitle="Add a document"
      @modalInputPlaceholder="Search by title, author, doc number..."
    >
      <:header as |rr|>
        <div
          class="flex h-12 items-center rounded-t border-b border-b-color-border-primary bg-color-surface-faint"
        >
          <div class="w-full px-4">
            <div class="flex items-center justify-between">
              <h3 class="text-body-100 font-semibold">
                Documents
              </h3>
              <Hds::Button
                @text="Add a document"
                @size="small"
                @color="secondary"
                @icon="plus"
                @isIconOnly={{true}}
              />
            </div>
          </div>
        </div>
      </:header>
      <:list>
        {{#if @project.documents}}
          <ul class="divide-y divide-color-border-primary">
            {{#each @project.documents as |document|}}
              <li class="group">
                <LinkTo
                  @route="authenticated.document"
                  @model={{document.googleFileID}}
                  class="flex h-12 items-center hover:bg-color-surface-faint group-first:rounded-t group-last:rounded-b"
                >
                  <div class="flex w-full items-center justify-between px-4">
                    <div class="flex items-center">
                      <Person::Avatar
                        @email="{{document.product}}"
                        @size="small"
                        class="mr-2"
                      />
                      <h4 class="text-display-200 font-semibold">
                        {{document.documentNumber}}
                        {{document.title}}
                      </h4>
                    </div>
                    <div class="flex space-x-1">
                      {{!-- <Hds::Badge
                        @text="{{document.product}}"
                        @icon={{or (get-product-id document.product) undefined}}
                      /> --}}
                      <Hds::Badge @text={{document.type}} />
                      <Doc::State
                        @hideProgress={{true}}
                        @state={{document.status}}
                      />
                    </div>
                  </div>
                </LinkTo>
              </li>
            {{/each}}
          </ul>
        {{else}}
          <div
            class="text-color-foreground w-full-faint flex h-12 items-center justify-center text-color-foreground-faint opacity-70"
          >
            None
          </div>
        {{/if}}
      </:list>
    </RelatedResources>
  </div>

  {{! PROJECTS }}
  <div
    class="mx-auto mb-8 max-w-2xl rounded border border-color-border-primary"
  >
    <RelatedResources
      @items={{this.relatedLinks}}
      @addResource={{this.addResource}}
      @modalHeaderTitle="Add related link"
      @modalInputPlaceholder="Enter a URL"
      @scope="external-links"
    >
      <:header as |rr|>
        <div
          class="flex h-12 items-center rounded-t border-b border-b-color-border-primary bg-color-surface-faint"
        >
          <div class="w-full px-4">
            <div class="flex items-center justify-between">
              <h3 class="text-body-100 font-semibold">
                Related links
              </h3>
              <Hds::Button
                {{on "click" rr.showModal}}
                @text="Add a related link"
                @size="small"
                @color="secondary"
                @icon="plus"
                @isIconOnly={{true}}
              />
            </div>
          </div>
        </div>
      </:header>
      <:list as |rr|>
        {{#if rr.items.length}}
          <ul class="divide-y divide-color-border-primary">
            {{#each rr.items as |link|}}
              <li>
                <ExternalLink href={{link.url}} class="flex h-12 items-center">
                  <div class="px-4">
                    {{link.name}}
                  </div>
                  <div>{{link.url}}</div>
                </ExternalLink>
              </li>
            {{/each}}
          </ul>
        {{else}}
          <div
            class="text-color-foreground w-full-faint flex h-12 items-center justify-center text-color-foreground-faint opacity-70"
          >
            None
          </div>
        {{/if}}
      </:list>
    </RelatedResources>
  </div>

  <div class="mb-4 text-center text-body-100 text-color-foreground-faint">
    Created
    {{time-ago @project.dateCreated}}
    by
    {{@project.creator}}
  </div>
</div>
