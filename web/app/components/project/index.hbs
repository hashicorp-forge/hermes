<div class="project-header mt-1 flex w-full">
  <div class="flex h-9 gap-1.5">
    <div class="flex gap-2.5">

      <X::DropdownList
        @items={{this.statuses}}
        @placement="bottom-start"
        @selected={{this.status}}
        class="theme--neutral"
      >
        <:anchor as |dd|>
          <dd.ToggleAction
            data-test-project-status-toggle
            class="hds-button hds-button--size-medium hds-button--color-secondary rounded-r-full rounded-l-full border-color-border-strong"
            @hasChevron={{true}}
          >
            <Project::StatusIcon @status={{dd.selected}} />
            <span class="ml-1 mr-0.5">
              {{this.statusLabel}}
            </span>
          </dd.ToggleAction>
        </:anchor>
        <:item as |dd|>
          <dd.Action
            data-test-status-action={{dd.value}}
            {{on "click" (fn this.changeStatus dd.value)}}
          >
            <X::DropdownList::CheckableItem
              @isSelected={{dd.isSelected}}
              @checkmarkPosition="trailing"
              class=""
            >
              <:default>
                <div class="flex items-center gap-2 pl-1.5">
                  <Project::StatusIcon @status={{dd.value}} />
                  <span>
                    {{dd.attrs.label}}
                  </span>
                </div>
              </:default>
            </X::DropdownList::CheckableItem>
          </dd.Action>
        </:item>
      </X::DropdownList>
    </div>

    <CopyURLButton
      @isIconOnly={{true}}
      @url={{this.url}}
      class="hds-button hds-button--color-secondary w-9 justify-center rounded-full border-color-border-strong p-0"
    />

  </div>
</div>
<AnimatedContainer @motion={{this.motion}}>
  <div class="pb-6">
    <div class="relative z-20 mb-5 max-w-3xl">
      <AnimatedContainer @motion={{this.motion}}>

        {{! Title }}
        <div class="mt-7 flex">
          <EditableField
            class="project-title text-display-600"
            data-test-project-title
            @value={{this.title}}
            @tag="h1"
            @placeholder="Add project title"
            @buttonSize="medium"
            @onSave={{this.saveTitle}}
            @isReadOnly={{not this.projectIsActive}}
            @isRequired={{true}}
            @isSaving={{this.titleIsSaving}}
          />
        </div>

        {{#animated-if
          (or this.description this.projectIsActive)
          rules=this.descriptionTransitionRules
        }}
          {{! Description }}
          <div class="flex">
            <EditableField
              class="project-description"
              data-test-project-description
              @value="{{this.description}}"
              @onSave={{this.saveDescription}}
              @isReadOnly={{not this.projectIsActive}}
              @isSaving={{this.descriptionIsSaving}}
              @placeholder="Add a description"
              @buttonSize="medium"
            />
          </div>
        {{/animated-if}}
      </AnimatedContainer>

    </div>

    {{#if this.jiraIsEnabled}}
      <AnimatedContainer @motion={{this.motion}}>
        {{! Jira }}
        {{#animated-if this.jiraWidgetIsShown rules=this.jiraTransitionRules}}
          <div
            class="mt-5 flex w-full max-w-3xl"
            {{did-insert this.maybeLoadJiraInfo}}
          >
            <Project::JiraWidget
              @issue={{this.jiraIssue}}
              @onIssueRemove={{this.removeJiraIssue}}
              @onIssueSelect={{this.addJiraIssue}}
              @isLoading={{this.loadJiraIssue.isRunning}}
              @isReadOnly={{not this.projectIsActive}}
            />
          </div>
        {{/animated-if}}
      </AnimatedContainer>
    {{/if}}

    {{! Plus button }}
    <RelatedResources
      @modalHeaderTitle="Add project resource"
      @modalInputPlaceholder="Search docs or paste a URL..."
      @addResource={{this.addResource}}
    >
      <:header as |rr|>
        {{#animated-if
          this.projectIsActive
          rules=this.plusButtonTransitionRules
          initialInsertion=true
          finalRemoval=true
        }}
          <Action
            data-test-add-project-resource-button
            {{on "click" rr.showModal}}
            class="hds-button hds-button--color-primary add-project-resource-button pointer-events-auto absolute right-14 bottom-0 grid aspect-square h-20 w-20 translate-y-1/2 place-items-center rounded-full"
          >

            <FlightIcon @name="plus" @size="24" class="h-9 w-9" />
          </Action>
        {{/animated-if}}
      </:header>
    </RelatedResources>
  </div>
</AnimatedContainer>

<div class="relative border-t border-t-color-border-primary">

  {{! Resources }}
  <div class="max-w-3xl">
    {{#if (or this.hermesDocuments.length this.externalLinks.length)}}
      {{#if this.hermesDocuments.length}}

        {{! Documents }}
        <div class="mt-7 flex h-6 items-center gap-2">
          <h3 data-test-documents-header class="hermes-h4">
            Documents
          </h3>
          <Hds::BadgeCount
            data-test-document-count
            @text="{{this.hermesDocuments.length}}"
          />
        </div>
        <ol data-test-document-list class="divided-list mt-3">
          {{#each this.hermesDocuments as |document|}}
            <li class="group relative" data-test-document-list-item>
              <Project::Resource
                @isReadOnly={{not this.projectIsActive}}
                @overflowMenuItems={{hash
                  delete=(hash
                    label="Remove"
                    icon="trash"
                    action=(fn this.deleteResource document)
                  )
                }}
              >
                <Doc::TileMedium
                  @doc={{document}}
                  @avatarIsLoading={{this.getOwnerPhoto.isRunning}}
                />
              </Project::Resource>
            </li>
          {{/each}}
        </ol>
      {{/if}}

      {{#if this.externalLinks.length}}
        {{! External links }}
        <div class="mt-7 flex h-6 items-center gap-2">
          <h3 data-test-external-links-header class="hermes-h4">
            External links
          </h3>
          <Hds::BadgeCount
            data-test-external-link-count
            @text="{{this.externalLinks.length}}"
          />
        </div>
        <ol data-test-external-link-list class="divided-list mt-5">
          {{#each this.externalLinks as |link i|}}
            <li class="group" data-test-document-list-item>
              <Project::Resource
                @isReadOnly={{not this.projectIsActive}}
                @overflowMenuItems={{hash
                  edit=(hash
                    label="Edit"
                    icon="edit"
                    action=(fn this.showEditModal link i)
                  )
                  delete=(hash
                    label="Remove"
                    icon="trash"
                    action=(fn this.deleteResource link)
                  )
                }}
              >
                <ExternalLink
                  data-test-related-link
                  href={{link.url}}
                  class="block px-2 pt-2.5 pb-2.5 group-hover:bg-color-surface-faint"
                >
                  <div class="flex items-center gap-4">
                    <div class="flex w-9 justify-end">
                      <Favicon @url={{link.url}} />
                    </div>
                    <div class="flex w-full gap-2">
                      <h4
                        class="max-w-[65%] truncate text-display-300 font-semibold text-color-foreground-strong"
                      >
                        {{link.name}}
                      </h4>
                      <div
                        class="mt-1 max-w-[35%] truncate text-[11px] text-color-foreground-faint"
                      >
                        {{link.url}}
                      </div>
                    </div>
                  </div>
                </ExternalLink>
              </Project::Resource>
            </li>
          {{/each}}
        </ol>
      {{/if}}
    {{else}}
      <div
        data-test-empty-body
        class="mt-7 flex h-48 flex-col items-start justify-center"
      >
        <div class="text-display-300 font-bold text-color-foreground-strong">
          Nothing here yet
        </div>
        <div class="mt-1.5 text-body-200">
          Add documents and links using the + button
        </div>
      </div>
    {{/if}}

    <div
      class="mt-14 -mb-6 flex gap-[5px] text-body-100 text-color-foreground-disabled"
    >
      <span data-test-created-time>
        Created
        {{time-ago @project.createdTime}}
        by
        {{@project.creator}}
      </span>
      <span class="opacity-50">|</span>
      <span data-test-modified-time>
        Last modified
        {{time-ago @project.modifiedTime}}
      </span>
    </div>
  </div>
</div>

{{#if this.editModalIsShown}}
  <RelatedResources::AddOrEditExternalResourceModal
    @resource={{this.resourceToEdit}}
    @onClose={{this.hideEditModal}}
    @onSave={{this.saveExternalLink}}
  />
{{/if}}
