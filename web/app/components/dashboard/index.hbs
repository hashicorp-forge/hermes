<Dashboard::NewFeaturesBanner />

<div class="mt-3 flex w-full" {{did-insert (perform this.fetchLatestDocs)}}>
  <div class="min-h-[500px] w-full overflow-hidden pb-20">
    <div class="pr-4">

      <div class="mb-6 flex items-center gap-3">
        <h4 class="hermes-h4">
          Welcome back,
          {{this.authenticatedUser.info.given_name}}!
        </h4>
      </div>

      {{#if @docsAwaitingReview}}
        <Dashboard::DocsAwaitingReview @docs={{@docsAwaitingReview}} />
      {{/if}}

      <div class="flex items-center gap-3.5">
        <h4 class="flex gap-2.5 text-display-400 text-color-foreground-strong">
          Latest docs
        </h4>
      </div>
      {{#if this.latestDocs}}
        <ol class="mt-5">
          {{#each this.latestDocs as |doc|}}
            <li class="border-t border-color-border-faint">
              <LinkTo
                @route="authenticated.document"
                @model={{doc.objectID}}
                @query={{hash draft=doc.isDraft}}
                class="block hover:bg-color-surface-faint"
              >
                <div
                  class="relative flex justify-between gap-5 pl-3 pr-6 pt-5 pb-6"
                >
                  <Person::Avatar
                    @size="large"
                    @email="{{get doc.owners 0}}"
                    @imgURL={{get doc.ownerPhotos 0}}
                    class="-mt-1 shrink-0"
                  />
                  <div class="w-full">

                    {{! Title and docNumber }}
                    <div class="relative z-10 overflow-hidden">
                      <h4
                        class="text-display-300 font-semibold text-color-foreground-strong"
                      >
                        <span data-test-document-title class="mr-1.5">
                          {{doc.title}}
                        </span>
                        <span
                          data-test-document-number
                          class="shrink-0 font-regular text-color-foreground-faint"
                        >
                          <span class="whitespace-nowrap">
                            {{doc.docNumber}}
                          </span>
                        </span>
                      </h4>
                    </div>
                    {{! Owner }}
                    <div
                      class="mt-1.5 flex items-center gap-[5px] text-color-foreground-faint"
                    >
                      <span class="text-color-foreground-X">
                        {{get doc.owners 0}}
                      </span>
                      <span class="opacity-50">
                        |
                      </span>
                      {{doc.product}}
                      <span class="opacity-50">
                        |
                      </span>
                      {{time-ago doc.createdTime}}
                    </div>

                    {{#if doc.summary}}
                      <p class="mt-2.5 max-w-xl text-body-300">
                        {{doc.summary}}
                      </p>
                    {{/if}}

                    <div class="mt-3.5 flex items-center gap-1">
                      <Doc::State
                        @state={{doc.status}}
                        @hideProgress={{true}}
                        class="interactive"
                      />
                      <Hds::Badge @text={{doc.docType}} />
                    </div>

                  </div>
                  <div class="relative ml-2 shrink-0">
                    <Doc::Thumbnail
                      @status={{doc.status}}
                      @product={{doc.product}}
                      @size="medium"
                      class="shrink-0 self-start"
                    />
                  </div>
                </div>
              </LinkTo>
            </li>
          {{/each}}
        </ol>

        {{#if this.linkToAllDocsIsShown}}
          <div class="mt-5 pl-3 pr-7">
            <Hds::Button
              @color="secondary"
              @text="See older documents"
              @icon="arrow-right"
              @iconPosition="trailing"
              @isFullWidth={{true}}
              @route="authenticated.documents"
              @query={{hash page=2}}
              class="py-3"
            />
          </div>
        {{/if}}
      {{else if this.fetchLatestDocs.isRunning}}
        {{log "fetching latest docs (template)"}}
        <div class="h-[100px]">
          <FlightIcon @name="loading" class="mt-1" />
        </div>
      {{else if (eq this.latestDocs null)}}
        <div class="h-[100px]">
          <p class="mb-7 text-body-300 text-color-foreground-faint">
            Error fetching documents.
          </p>
          <Hds::Button
            @text="Retry"
            @color="secondary"
            @size="small"
            @icon="reload"
            {{on "click" (perform this.fetchLatestDocs)}}
          />
        </div>
      {{else}}
        <div class="mt-5 text-display-300 text-color-foreground-disabled">
          No documents have been published yet.
        </div>
        <Hds::Button
          @text="Create a new document"
          @iconPosition="leading"
          @route="authenticated.new"
          class="mt-5"
        />
      {{/if}}
    </div>
  </div>

  <div class="flex w-72 shrink-0 pt-10">
    <div class="relative h-full pl-4">

      {{! Vertical line }}
      <div class="absolute left-0 top-0 h-full w-px bg-color-border-primary" />

      <div class="mt-2.5 flex items-center gap-3 pl-3">
        <h4 class="text-display-300 text-color-foreground-strong">
          Recently viewed
        </h4>
      </div>
      {{#if this.recentlyViewedDocs.all}}
        <ul class="mt-4">
          {{#each this.recentlyViewedDocs.all as |r|}}
            <li class="border-b border-color-border-faint last:border-0">
              <LinkTo
                @route="authenticated.document"
                @model={{r.doc.objectID}}
                @query={{hash draft=r.doc.isDraft}}
                class="block px-3 pt-3 pb-3.5 hover:bg-color-surface-faint"
              >
                <div class="flex w-full gap-5">

                  <div class="w-full">

                    <div class="flex items-center gap-[5px]">
                      <Person::Avatar
                        @email={{get r.doc.owners 0}}
                        @imgURL={{get r.doc.ownerPhotos 0}}
                      />
                      <span class="text-color-foreground-faint opacity-50">
                        |
                      </span>
                      <span class="text-body-100 text-color-foreground-faint">

                        {{r.doc.product}}
                      </span>
                    </div>
                    <h5
                      class="mt-1.5 text-body-200 font-semibold text-color-foreground-strong"
                    >
                      {{r.doc.title}}
                    </h5>
                    <p class="mt-0.5 text-body-100 text-color-foreground-faint">
                      Modified
                      {{time-ago r.doc.modifiedTime}}
                    </p>
                  </div>
                  <Doc::Thumbnail
                    @status={{r.doc.status}}
                    @product={{r.doc.product}}
                    @size="small"
                    class="shrink-0 self-start"
                  />
                </div>
              </LinkTo>
            </li>
          {{/each}}
        </ul>
      {{else}}
        <div class="mt-5 px-3 text-body-300 text-color-foreground-disabled">
          You haven't viewed any documents yet.
        </div>
      {{/if}}
    </div>

  </div>
</div>
